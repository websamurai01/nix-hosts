#!/usr/bin/env bash

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ curl
if ! command -v curl &> /dev/null; then
    echo "üö´"
    exit 1
fi

# –ü–æ–ª—É—á–∞–µ–º –¥–≤—É—Ö–±—É–∫–≤–µ–Ω–Ω—ã–π –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã —Å —Ç–∞–π–º–∞—É—Ç–æ–º –≤ 5 —Å–µ–∫—É–Ω–¥
COUNTRY_CODE=$(curl -s --max-time 5 'http://ip-api.com/line/?fields=countryCode')

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–¥ —Å–æ—Å—Ç–æ–∏—Ç —Ä–æ–≤–Ω–æ –∏–∑ –¥–≤—É—Ö –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –±—É–∫–≤
if ! [[ "$COUNTRY_CODE" =~ ^[A-Z]{2}$ ]]; then
    echo "üè¥‚Äç‚ò†Ô∏è" # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∏—Ä–∞—Ç—Å–∫–∏–π —Ñ–ª–∞–≥ –ø—Ä–∏ –æ—à–∏–±–∫–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏
    exit 0
fi

# –ú–∞–≥–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –±—É–∫–≤ –≤ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã Unicode
char1=$(echo "$COUNTRY_CODE" | cut -c1)
char2=$(echo "$COUNTRY_CODE" | cut -c2)

# –ò—Å–ø–æ–ª—å–∑—É–µ–º LC_CTYPE=C –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è ASCII –∫–æ–¥–æ–≤, –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å —Å–ª–æ–º–∞–Ω–∞
code1=$(LC_CTYPE=C printf '%d' "'$char1")
code2=$(LC_CTYPE=C printf '%d' "'$char2")

flag1_dec=$(( code1 + 127397 ))
flag2_dec=$(( code2 + 127397 ))

# –°–æ–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥
FLAG=$(printf "\\U$(printf '%x' $flag1_dec)\\U$(printf '%x' $flag2_dec)")

echo "$FLAG"
